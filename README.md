# :books: Global github actions workflows

> This is a collection of GitHub Actions workflows that can be used withing any repository of the [Garajonai Org](https://github.com/garajonai).

## Workflows

- [load-secrets](./load-secrets/action.yaml): Load secrets from 1Password and generate a PAT with the context of
`Botanibit` bot.
- [changelog](./changelog/action.yaml): Generate a changelog based on the commits of the repository. Currently only
available for `go` projects and `npm` is a *WIP*.

## Botanibit `bot`

<img src="./public/img/botanibit.png" align="right" width="250" />

The `Botanibit` bot is a GitHub app that is used to perform actions on behalf of the `GarajonAI` organization. It is used to perform actions such as:
- Plan a release
- Follow up a Canary deployment
- Maintain the repository's changelog
- Keep in sync the `client-x` libraries

## Usage

To use any of the workflows in this repository, you can use the following steps:

1. Create a Repository secret with the name `OP_TOKEN` and the value of the Personal Access Token (PAT), you can find it
   in 1Password as `"op://Garajonai/Botanibit OP_SVC/credential"`.
2. Create a `.github/workflows` directory in the root of your repository.
3. Use the `uses` key to include the workflow in your repository.

### Load secrets

```yml
jobs:
  example:
    runs-on: ubuntu-latest
    steps:
      - name: Load secrets
        uses: garajonai/workflows-lib/load-secrets@main
        id: botanibit
        with:
          op-token: ${{ secrets.OP_TOKEN }}
          stack: go # optional, (go|npm|all|none), default: none

      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ steps.botanibit.outputs.token }} # Use the token generated by the previous step
```

### Changelog

```yml
jobs:
  example:
    runs-on: ubuntu-latest
      - name: Release changelog
        uses: garajonai/workflows-lib/changelog@main
        with:
          token: ${{ steps.botanibit.outputs.token }}
          stack: go
          next-version: ${{ github.event.inputs.next_version }}
```
